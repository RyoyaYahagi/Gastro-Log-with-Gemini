<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gastro Log (Gemini AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        main { padding-top: 70px; padding-bottom: 80px; }
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        input::-webkit-calendar-picker-indicator { opacity: 100; }
        
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: start; padding-top: 4px; border-radius: 8px; font-size: 0.8rem; position: relative; cursor: pointer; }
        .calendar-day:hover { background-color: #f3f4f6; }
        .calendar-day.selected { background-color: #eff6ff; border: 2px solid #3b82f6; font-weight: bold; }
        .calendar-day.today { background-color: #fff7ed; border: 1px solid #fdba74; }
        .dot { width: 6px; height: 6px; border-radius: 50%; margin-top: 2px; }
    </style>
</head>
<body class="text-gray-800 font-sans antialiased">
    <header class="bg-white shadow-sm fixed top-0 left-0 w-full z-50">
        <div class="max-w-md mx-auto px-4 h-16 flex justify-between items-center">
            <h1 class="text-xl font-bold text-blue-600 flex items-center"><i class="fa-solid fa-notes-medical mr-2"></i>Gastro Log</h1>
            <button onclick="clearAllData()" class="text-xs text-gray-400 hover:text-red-600 flex items-center"><i class="fa-solid fa-trash mr-1"></i> å±¥æ­´å‰Šé™¤</button>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 min-h-screen">
        <section id="view-analyze" class="view-section active">
            <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
                <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3">é£Ÿäº‹ãƒ»å†™çœŸ</h2>
                <div class="mb-4">
                    <label for="cameraInput" id="imageUploadLabel" class="cursor-pointer block w-full h-40 border-2 border-dashed border-blue-200 rounded-xl flex flex-col justify-center items-center hover:bg-blue-50 transition relative overflow-hidden bg-gray-50">
                        <div id="uploadPlaceholder" class="flex flex-col items-center text-gray-400"><i class="fa-solid fa-camera text-2xl mb-2"></i><span class="text-xs">å†™çœŸã‚’æ’®å½±ãƒ»é¸æŠ</span></div>
                        <img id="previewImage" class="hidden absolute inset-0 w-full h-full object-cover" />
                        <button id="removeImageBtn" onclick="removeImage(event)" class="hidden absolute top-2 right-2 bg-gray-800 bg-opacity-60 text-white rounded-full w-8 h-8 flex items-center justify-center z-10 hover:bg-red-600 transition"><i class="fa-solid fa-xmark"></i></button>
                    </label>
                    <input type="file" id="cameraInput" accept="image/*" class="hidden" onchange="handleImageSelect(event)">
                </div>
                <div class="mb-6 relative">
                    <textarea id="textInput" rows="2" placeholder="é£Ÿäº‹ã®ãƒ¡ãƒ¢..." class="w-full p-3 border border-gray-200 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-gray-50" oninput="checkAnalyzeable()"></textarea>
                </div>

                <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3 border-t pt-4">ç”Ÿæ´»ãƒ»ä½“èª¿ãƒ­ã‚°</h2>
                <div id="autoFillMessage" class="hidden mb-3 bg-indigo-50 text-indigo-700 px-3 py-2 rounded-lg text-xs flex items-center animate-pulse">
                    <i class="fa-solid fa-mobile-screen-button mr-2"></i>å¤–éƒ¨ã‚¢ãƒ—ãƒªã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ
                </div>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div><label class="block text-xs font-bold text-gray-600 mb-1"><i class="fa-solid fa-bed mr-1"></i>ç¡çœ æ™‚é–“(h)</label><input type="number" id="sleepTime" step="0.5" placeholder="7.0" class="w-full p-2 border border-gray-200 rounded-lg bg-gray-50 text-sm"></div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1"><i class="fa-solid fa-star-half-stroke mr-1"></i>ç¡çœ ã®è³ª</label>
                        <select id="sleepQuality" class="w-full p-2 border border-gray-200 rounded-lg bg-gray-50 text-sm">
                            <option value="">-</option><option value="good">è‰¯ã„</option><option value="normal">æ™®é€š</option><option value="bad">æ‚ªã„</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div><label class="block text-xs font-bold text-gray-600 mb-1"><i class="fa-solid fa-shoe-prints mr-1"></i>æ­©æ•°(æ­©)</label><input type="number" id="stepsInput" placeholder="5000" class="w-full p-2 border border-gray-200 rounded-lg bg-gray-50 text-sm"></div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 mb-1"><i class="fa-solid fa-pills mr-1"></i>è–¬ãƒ»ã‚µãƒ—ãƒª</label>
                        <div class="relative">
                            <input type="text" id="medicationInput" list="medicationHistoryList" placeholder="é¸æŠã¾ãŸã¯å…¥åŠ›" autocomplete="off" class="w-full p-2 border border-gray-200 rounded-lg bg-gray-50 text-sm">
                            <datalist id="medicationHistoryList"></datalist>
                        </div>
                    </div>
                </div>
                <div class="mb-6"><label class="block text-xs font-bold text-gray-600 mb-1"><i class="fa-solid fa-person-walking mr-1"></i>ãã®ä»–ã®é‹å‹•</label><input type="text" id="exerciseInput" placeholder="ä¾‹: ãƒ¨ã‚¬15åˆ†" class="w-full p-2 border border-gray-200 rounded-lg bg-gray-50 text-sm"></div>

                <div id="loadingArea" class="hidden flex flex-col items-center justify-center py-6 bg-blue-50 rounded-xl mb-4"><div class="loader mb-3"></div><p class="text-sm text-blue-600 font-bold animate-pulse">AIãŒè§£æä¸­...</p></div>
                <div class="flex gap-3" id="actionButtons">
                    <button onclick="saveLog(false)" id="quickSaveBtn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-3 px-2 rounded-xl text-sm transition flex flex-col items-center justify-center"><span class="text-xs mb-0.5"><i class="fa-solid fa-pen mr-1"></i>è§£æã›ãš</span>ãã®ã¾ã¾è¨˜éŒ²</button>
                    <button onclick="analyze()" id="analyzeBtn" class="flex-[2] bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center" disabled><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>AIè§£æã—ã¦è¨˜éŒ²</button>
                </div>
            </div>
            <div id="resultArea" class="hidden bg-white rounded-xl shadow-sm border-l-4 border-green-500 overflow-hidden mb-8">
                <div class="p-5">
                    <h3 class="font-bold text-lg mb-3 flex items-center"><i class="fa-solid fa-circle-check text-green-500 mr-2"></i>è§£æçµæœ</h3>
                    <div id="tagsContainer" class="flex flex-wrap gap-2 mb-5"></div>
                    <button onclick="saveLog(true)" class="w-full bg-green-50 hover:bg-green-100 text-green-700 font-bold py-3 px-4 rounded-xl flex items-center justify-center transition"><i class="fa-solid fa-floppy-disk mr-2"></i>ã“ã®å†…å®¹ã§ä¿å­˜</button>
                </div>
            </div>
        </section>

        <section id="view-history" class="view-section">
            <div class="flex bg-white rounded-xl shadow-sm p-1 mb-4">
                <button onclick="toggleHistoryView('list')" id="btnViewList" class="flex-1 py-2 text-sm font-bold rounded-lg bg-blue-50 text-blue-600 transition"><i class="fa-solid fa-list-ul mr-1"></i>ãƒªã‚¹ãƒˆ</button>
                <button onclick="toggleHistoryView('calendar')" id="btnViewCalendar" class="flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:bg-gray-50 transition"><i class="fa-solid fa-calendar-days mr-1"></i>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
                <h2 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-4 flex items-center"><i class="fa-solid fa-chart-simple mr-2"></i>æˆåˆ†ãƒ©ãƒ³ã‚­ãƒ³ã‚° (TOP 5)</h2>
                <div id="statsContainer" class="space-y-3"></div>
            </div>

            <div id="calendarContainer" class="hidden bg-white rounded-xl shadow-sm p-4 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="changeMonth(-1)" class="text-gray-400 hover:text-blue-600 p-2"><i class="fa-solid fa-chevron-left"></i></button>
                    <h2 id="calendarTitle" class="text-lg font-bold text-gray-700"></h2>
                    <button onclick="changeMonth(1)" class="text-gray-400 hover:text-blue-600 p-2"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div class="grid grid-cols-7 gap-1 mb-2 text-center text-xs font-bold text-gray-400">
                    <span class="text-red-400">æ—¥</span><span>æœˆ</span><span>ç«</span><span>æ°´</span><span>æœ¨</span><span>é‡‘</span><span class="text-blue-400">åœŸ</span>
                </div>
                <div id="calendarGrid" class="calendar-grid"></div>
                
                <div class="mt-4 flex justify-center gap-4 text-xs text-gray-500">
                    <div class="flex items-center"><div class="dot bg-red-500 mr-1"></div>æ³¨æ„ã‚ã‚Š</div>
                    <div class="flex items-center"><div class="dot bg-green-500 mr-1"></div>è‰¯å¥½</div>
                    <div class="flex items-center"><div class="dot bg-blue-400 mr-1"></div>ç”Ÿæ´»ãƒ­ã‚°ã®ã¿</div>
                </div>
            </div>

            <h2 id="historyListTitle" class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-4 pl-2">è¨˜éŒ²ãƒ­ã‚°</h2>
            <div id="historyList" class="space-y-4"></div>
        </section>

        <section id="view-settings" class="view-section">
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold mb-6 flex items-center"><i class="fa-solid fa-sliders mr-2"></i>è¨­å®š</h2>
                <div class="mb-6"><label class="block text-sm font-bold mb-2 text-gray-700">Gemini API Key <span class="text-red-500">*</span></label><div class="relative"><input type="password" id="apiKeyInput" placeholder="AIzaSy..." class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10"><i class="fa-solid fa-key absolute top-3.5 right-3 text-gray-300"></i></div></div>
                <div class="mb-6"><label class="block text-sm font-bold mb-2 text-gray-700">ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«</label><div id="modelSelectContainer" class="relative mb-2"><select id="modelSelect" class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"><option value="gemini-2.5-flash">gemini-2.5-flash (æ¨å¥¨)</option><option value="gemini-2.0-flash">gemini-2.0-flash</option></select><i class="fa-solid fa-chevron-down absolute top-4 right-4 text-gray-400 pointer-events-none"></i></div><div id="modelInputContainer" class="relative mb-2 hidden"><input type="text" id="modelInput" placeholder="ãƒ¢ãƒ‡ãƒ«åã‚’æ‰‹å…¥åŠ›" class="w-full p-3 border border-gray-200 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"><i class="fa-solid fa-robot absolute top-3.5 right-3 text-gray-300"></i></div><div class="flex gap-2"><button onclick="fetchModels()" id="fetchModelsBtn" class="flex-1 text-xs bg-blue-50 text-blue-700 font-bold px-3 py-2.5 rounded-lg hover:bg-blue-100 transition flex items-center justify-center"><i class="fa-solid fa-cloud-arrow-down mr-1"></i>ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’æ›´æ–°</button><button onclick="toggleModelInputMode()" class="text-xs bg-gray-100 text-gray-500 font-bold px-3 py-2.5 rounded-lg hover:bg-gray-200 transition"><i class="fa-solid fa-pen mr-1"></i>æ‰‹å…¥åŠ›</button></div><p id="modelFetchStatus" class="text-xs text-gray-400 mt-2 h-4"></p></div>
                <div class="mb-8 pt-6 border-t border-gray-100"><label class="block text-sm font-bold mb-2 text-gray-700">ä¿å­˜ã•ã‚ŒãŸè–¬ãƒªã‚¹ãƒˆ</label><p class="text-xs text-gray-400 mb-2">ã€Œè¨˜éŒ²ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æ–°ã—ã„è–¬ã®åå‰ãŒè‡ªå‹•ã§ã“ã“ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p><div class="flex gap-2"><button onclick="clearMedicationHistory()" class="text-xs bg-red-50 text-red-600 font-bold px-3 py-2 rounded-lg hover:bg-red-100 transition"><i class="fa-solid fa-eraser mr-1"></i>è–¬ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ</button></div></div>
                <button onclick="saveSettings()" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-4 rounded-xl transition">è¨­å®šã‚’ä¿å­˜ã—ã¦æˆ»ã‚‹</button>
            </div>
            <div class="p-4 rounded-xl text-sm text-gray-500 text-center"><p>Â© 2024 Gastro Log v3.0</p></div>
        </section>
    </main>
    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 z-50 pb-safe">
        <div class="max-w-md mx-auto flex justify-around items-center h-16">
            <button onclick="switchView('analyze')" class="nav-btn active flex-1 flex flex-col items-center justify-center text-gray-400 transition"><i class="fa-solid fa-camera text-xl mb-1"></i><span class="text-xs font-bold">å…¥åŠ›ãƒ»è§£æ</span></button>
            <button onclick="switchView('history')" class="nav-btn flex-1 flex flex-col items-center justify-center text-gray-400 transition"><i class="fa-solid fa-list-ul text-xl mb-1"></i><span class="text-xs font-bold">è¨˜éŒ²ãƒ»é›†è¨ˆ</span></button>
            <button onclick="switchView('settings')" class="nav-btn flex-1 flex flex-col items-center justify-center text-gray-400 transition"><i class="fa-solid fa-gear text-xl mb-1"></i><span class="text-xs font-bold">è¨­å®š</span></button>
        </div>
    </nav>
    <script>
        let currentBase64 = null; let currentIngredients = []; let isManualModelMode = false;
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨å¤‰æ•°
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth(); // 0-11
        let currentViewMode = 'list'; // 'list' or 'calendar'
        let selectedDate = null; // çµã‚Šè¾¼ã¿ä¸­ã®æ—¥ä»˜(Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            if(!localStorage.getItem('gemini_api_key')) { switchView('settings'); } else { updateNavStyles('analyze'); }
            checkAnalyzeable(); checkUrlParams(); loadMedicationHistory();
        });

        // --- URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª­ã¿å–ã‚Š ---
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            let hasData = false;
            if (params.has('sleep')) { document.getElementById('sleepTime').value = params.get('sleep'); hasData = true; }
            if (params.has('quality')) { document.getElementById('sleepQuality').value = params.get('quality'); hasData = true; }
            if (params.has('steps')) { document.getElementById('stepsInput').value = params.get('steps'); hasData = true; }
            if (params.has('exercise')) { document.getElementById('exerciseInput').value = params.get('exercise'); hasData = true; }
            if (hasData) { document.getElementById('autoFillMessage').classList.remove('hidden'); window.history.replaceState({}, document.title, window.location.pathname); }
        }

        // --- ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ ---
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewName}`).classList.add('active');
            updateNavStyles(viewName); window.scrollTo(0, 0);
            if(viewName === 'history') { 
                // å±¥æ­´ç”»é¢ã‚’é–‹ã„ãŸã¨ãã¯ã€ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã§å†æç”»
                if (currentViewMode === 'calendar') {
                    renderCalendar();
                    // é¸æŠæ—¥ãŒã‚ã‚Œã°ãã®ãƒ­ã‚°ã€ãªã‘ã‚Œã°å…¨ãƒ­ã‚°
                    renderHistory(selectedDate);
                } else {
                    renderHistory(); // å…¨ãƒªã‚¹ãƒˆ
                }
                updateStats();
            }
        }
        function updateNavStyles(activeView) {
            const icons = { analyze: 0, history: 1, settings: 2 };
            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => btn.classList.remove('text-blue-600', 'text-gray-400'));
            navBtns.forEach(btn => btn.classList.add('text-gray-400'));
            if(navBtns[icons[activeView]]) { navBtns[icons[activeView]].classList.remove('text-gray-400'); navBtns[icons[activeView]].classList.add('text-blue-600'); }
        }

        // --- å±¥æ­´è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ (ãƒªã‚¹ãƒˆ vs ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼) ---
        function toggleHistoryView(mode) {
            currentViewMode = mode;
            const btnList = document.getElementById('btnViewList');
            const btnCal = document.getElementById('btnViewCalendar');
            const calContainer = document.getElementById('calendarContainer');
            const listTitle = document.getElementById('historyListTitle');

            if (mode === 'calendar') {
                btnList.classList.replace('bg-blue-50', 'text-gray-400'); btnList.classList.replace('text-blue-600', 'hover:bg-gray-50');
                btnCal.classList.replace('text-gray-400', 'bg-blue-50'); btnCal.classList.replace('hover:bg-gray-50', 'text-blue-600');
                calContainer.classList.remove('hidden');
                
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
                renderCalendar();
                // é¸æŠæ—¥ãƒªã‚»ãƒƒãƒˆï¼ˆåˆå›ã¯å…¨è¡¨ç¤ºã€ã¾ãŸã¯å½“æ—¥ãªã©ï¼‰
                // ã“ã“ã§ã¯ã€Œé¸æŠãªã—ï¼ˆå…¨è¡¨ç¤ºï¼‰ã€ã«ã™ã‚‹ã‹ã€å½“æ—¥ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
                renderHistory(selectedDate); 
                listTitle.textContent = selectedDate ? `${selectedDate.getMonth()+1}/${selectedDate.getDate()} ã®ãƒ­ã‚°` : "ãƒ­ã‚°ä¸€è¦§";
            } else {
                btnCal.classList.replace('bg-blue-50', 'text-gray-400'); btnCal.classList.replace('text-blue-600', 'hover:bg-gray-50');
                btnList.classList.replace('text-gray-400', 'bg-blue-50'); btnList.classList.replace('hover:bg-gray-50', 'text-blue-600');
                calContainer.classList.add('hidden');
                
                // å…¨ãƒªã‚¹ãƒˆè¡¨ç¤º
                selectedDate = null;
                renderHistory(null);
                listTitle.textContent = "ãƒ­ã‚°ä¸€è¦§";
            }
        }

        // --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ ---
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const title = document.getElementById('calendarTitle');
            grid.innerHTML = '';
            
            title.textContent = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay(); // 0(Sun) - 6(Sat)

            // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
            const history = JSON.parse(localStorage.getItem('food_history') || '[]');

            // ç©ºç™½ã‚»ãƒ« (æœˆåˆã®å‰)
            for (let i = 0; i < startDayOfWeek; i++) {
                grid.appendChild(document.createElement('div'));
            }

            // æ—¥ä»˜ã‚»ãƒ«
            const today = new Date();
            for (let d = 1; d <= daysInMonth; d++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = d;

                const thisDate = new Date(currentYear, currentMonth, d);
                
                // ä»Šæ—¥ã®å¼·èª¿
                if (thisDate.getFullYear() === today.getFullYear() && 
                    thisDate.getMonth() === today.getMonth() && 
                    thisDate.getDate() === today.getDate()) {
                    dayDiv.classList.add('today');
                }

                // é¸æŠæ—¥ã®å¼·èª¿
                if (selectedDate && 
                    thisDate.getFullYear() === selectedDate.getFullYear() && 
                    thisDate.getMonth() === selectedDate.getMonth() && 
                    thisDate.getDate() === selectedDate.getDate()) {
                    dayDiv.classList.add('selected');
                }

                // ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ¼ã‚«ãƒ¼ç¢ºèª
                // ã“ã®æ—¥ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹æ¤œç´¢
                const dayLogs = history.filter(item => {
                    const logDate = new Date(item.id); // IDãŒã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
                    return logDate.getFullYear() === currentYear &&
                           logDate.getMonth() === currentMonth &&
                           logDate.getDate() === d;
                });

                if (dayLogs.length > 0) {
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    
                    // è‰²ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
                    // 1. æ³¨æ„æˆåˆ†ã‚ã‚ŠãŒä¸€ã¤ã§ã‚‚ã‚ã‚Œã°ã€Œèµ¤ã€
                    // 2. æ³¨æ„æˆåˆ†ãªã—(ç·‘)ãŒã‚ã‚Œã°ã€Œç·‘ã€
                    // 3. ãã‚Œä»¥å¤–(ç”»åƒãªã—ã€ãƒ¡ãƒ¢ã®ã¿ãªã©)ã¯ã€Œé’ã€
                    const hasWarning = dayLogs.some(item => item.ingredients && item.ingredients.length > 0);
                    const hasSafeFood = dayLogs.some(item => item.ingredients && item.ingredients.length === 0 && (item.image || item.memo));
                    
                    if (hasWarning) {
                        dot.classList.add('bg-red-500');
                    } else if (hasSafeFood) {
                        dot.classList.add('bg-green-500');
                    } else {
                        dot.classList.add('bg-blue-400');
                    }
                    dayDiv.appendChild(dot);
                }

                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                dayDiv.onclick = () => {
                    // åŒã˜æ—¥ã‚’å†ã‚¿ãƒƒãƒ—ã—ãŸã‚‰é¸æŠè§£é™¤
                    if (selectedDate && selectedDate.getDate() === d && selectedDate.getMonth() === currentMonth) {
                        selectedDate = null;
                    } else {
                        selectedDate = new Date(currentYear, currentMonth, d);
                    }
                    renderCalendar(); // é¸æŠçŠ¶æ…‹æ›´æ–°ã®ãŸã‚å†æç”»
                    renderHistory(selectedDate);
                    
                    const listTitle = document.getElementById('historyListTitle');
                    listTitle.textContent = selectedDate ? `${currentMonth + 1}/${d} ã®ãƒ­ã‚°` : "ãƒ­ã‚°ä¸€è¦§";
                };

                grid.appendChild(dayDiv);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        // --- å±¥æ­´è¡¨ç¤º (ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯¾å¿œ) ---
        function renderHistory(filterDate = null) {
            const rawHistory = JSON.parse(localStorage.getItem('food_history') || '[]');
            const listContainer = document.getElementById('historyList');
            listContainer.innerHTML = '';

            let history = rawHistory;

            // æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãŒã‚ã‚‹å ´åˆ
            if (filterDate) {
                history = rawHistory.filter(item => {
                    const d = new Date(item.id);
                    return d.getFullYear() === filterDate.getFullYear() &&
                           d.getMonth() === filterDate.getMonth() &&
                           d.getDate() === filterDate.getDate();
                });
            }

            if (history.length === 0) {
                listContainer.innerHTML = `<div class="text-center text-gray-400 py-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200"><i class="fa-solid fa-utensils text-3xl mb-2 opacity-50"></i><p class="text-sm">ã“ã®æ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“</p></div>`;
                return;
            }

            history.forEach(item => {
                const tagsHtml = item.ingredients && item.ingredients.length > 0 ? item.ingredients.map(t => `<span class="bg-red-50 text-red-600 text-xs px-2 py-0.5 rounded border border-red-100">${t}</span>`).join('') : (item.image || (item.memo && !item.life) ? '<span class="text-xs text-green-600"><i class="fa-solid fa-check mr-1"></i>æˆåˆ†ãªã—</span>' : '');
                let lifeLogHtml = ''; const life = item.life || {};
                if (life.sleepTime) { const qMap = { good: 'è‰¯', normal: 'æ™®', bad: 'æ‚ª' }; const qText = qMap[life.sleepQuality] ? `(${qMap[life.sleepQuality]})` : ''; lifeLogHtml += `<span class="text-xs text-indigo-600 bg-indigo-50 px-2 py-1 rounded mr-2 mb-1 inline-block"><i class="fa-solid fa-bed mr-1"></i>${life.sleepTime}h ${qText}</span>`; }
                if (life.steps) { lifeLogHtml += `<span class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded mr-2 mb-1 inline-block"><i class="fa-solid fa-shoe-prints mr-1"></i>${life.steps}æ­©</span>`; }
                if (life.exercise) { lifeLogHtml += `<span class="text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded mr-2 mb-1 inline-block"><i class="fa-solid fa-person-running mr-1"></i>${life.exercise}</span>`; }
                if (life.medication) { lifeLogHtml += `<span class="text-xs text-teal-600 bg-teal-50 px-2 py-1 rounded mr-2 mb-1 inline-block"><i class="fa-solid fa-pills mr-1"></i>${life.medication}</span>`; }
                const imageHtml = item.image ? `<img src="${item.image}" class="w-20 h-20 object-cover rounded-lg bg-gray-200 border border-gray-100">` : `<div class="w-20 h-20 bg-gray-50 rounded-lg border border-gray-200 flex items-center justify-center text-gray-300"><i class="fa-solid fa-notes-medical text-2xl"></i></div>`;
                const memoHtml = item.memo ? `<p class="text-xs text-gray-600 mt-2 bg-gray-50 p-2 rounded border border-gray-100"><i class="fa-regular fa-comment mr-1 text-gray-400"></i>${item.memo}</p>` : '';
                const html = `<div class="bg-white rounded-xl shadow-sm p-4 relative"><button onclick="deleteLog(${item.id})" class="absolute top-3 right-3 text-gray-300 hover:text-red-500 p-1"><i class="fa-solid fa-trash-can"></i></button><div class="flex gap-4 items-start mb-2">${imageHtml}<div class="flex-1 min-w-0 pt-1"><p class="text-xs text-gray-400 mb-1.5 flex items-center"><i class="fa-regular fa-clock mr-1"></i>${item.date}</p><div class="flex flex-wrap gap-1.5 mb-2">${tagsHtml}</div><div class="flex flex-wrap gap-y-1">${lifeLogHtml}</div></div></div>${memoHtml}</div>`;
                listContainer.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- ãã®ä»–ã®åŸºæœ¬é–¢æ•° ---
        function loadMedicationHistory() {
            const list = JSON.parse(localStorage.getItem('medication_history') || '[]');
            const datalist = document.getElementById('medicationHistoryList'); datalist.innerHTML = '';
            list.forEach(item => { const option = document.createElement('option'); option.value = item; datalist.appendChild(option); });
        }
        function addToMedicationHistory(text) {
            if(!text) return; let list = JSON.parse(localStorage.getItem('medication_history') || '[]');
            if (!list.includes(text)) { list.push(text); localStorage.setItem('medication_history', JSON.stringify(list)); loadMedicationHistory(); }
        }
        function clearMedicationHistory() { if(!confirm('ä¿å­˜ã•ã‚ŒãŸè–¬ã®ãƒªã‚¹ãƒˆã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return; localStorage.removeItem('medication_history'); loadMedicationHistory(); alert('è–¬ãƒªã‚¹ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ'); }
        function saveSettings() {
            const key = document.getElementById('apiKeyInput').value.trim();
            let model; if (isManualModelMode) model = document.getElementById('modelInput').value.trim(); else model = document.getElementById('modelSelect').value;
            if(!key) { alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; } if(!model) { alert('ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            localStorage.setItem('gemini_api_key', key); localStorage.setItem('gemini_model', model); alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ'); switchView('analyze');
        }
        function loadSettings() {
            const key = localStorage.getItem('gemini_api_key'); const model = localStorage.getItem('gemini_model');
            if(key) document.getElementById('apiKeyInput').value = key;
            if (model) { const select = document.getElementById('modelSelect'); const optionExists = Array.from(select.options).some(opt => opt.value === model); if (optionExists) select.value = model; else { toggleModelInputMode(true); document.getElementById('modelInput').value = model; } } else { document.getElementById('modelSelect').value = "gemini-2.5-flash"; }
        }
        function toggleModelInputMode(forceManual = null) {
            const selectContainer = document.getElementById('modelSelectContainer'); const inputContainer = document.getElementById('modelInputContainer');
            if (forceManual === null) isManualModelMode = !isManualModelMode; else isManualModelMode = forceManual;
            if (isManualModelMode) { selectContainer.classList.add('hidden'); inputContainer.classList.remove('hidden'); } else { selectContainer.classList.remove('hidden'); inputContainer.classList.add('hidden'); }
        }
        async function fetchModels() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const statusEl = document.getElementById('modelFetchStatus'); const selectEl = document.getElementById('modelSelect'); const btn = document.getElementById('fetchModelsBtn');
            if (!apiKey) { alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            statusEl.textContent = 'ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’å–å¾—ä¸­(v1beta)...'; statusEl.className = 'text-xs text-blue-500 mt-2 animate-pulse'; btn.disabled = true;
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`;
                const res = await fetch(url); if(!res.ok) throw new Error(`Error: ${res.status}`);
                const data = await res.json();
                const availableModels = data.models.filter(m => m.supportedGenerationMethods && m.supportedGenerationMethods.includes("generateContent")).map(m => m.name.replace('models/', '')).sort();
                if (availableModels.length === 0) throw new Error('åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                selectEl.innerHTML = ''; availableModels.forEach(modelName => { const option = document.createElement('option'); option.value = modelName; option.textContent = modelName; if(modelName.includes('gemini-3') || modelName.includes('pro-preview')) option.textContent += ' ğŸš€(New)'; else if(modelName.includes('flash') && !modelName.includes('legacy')) option.textContent += ' âš¡'; selectEl.appendChild(option); });
                const bestModel = availableModels.find(m => m.includes('2.5-flash')) || availableModels[0]; selectEl.value = bestModel;
                if (isManualModelMode) toggleModelInputMode(false); statusEl.textContent = `å–å¾—æˆåŠŸ! ${availableModels.length}å€‹ã®ãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`; statusEl.className = 'text-xs text-green-600 mt-2';
            } catch (e) { console.error(e); statusEl.textContent = `å–å¾—å¤±æ•—: ${e.message}`; statusEl.className = 'text-xs text-red-500 mt-2'; alert('ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); } finally { btn.disabled = false; }
        }
        function handleImageSelect(event) {
            const file = event.target.files[0]; if (!file) return;
            resizeImage(file).then(resizedBase64 => { currentBase64 = resizedBase64; const imgEl = document.getElementById('previewImage'); imgEl.src = currentBase64; imgEl.classList.remove('hidden'); document.getElementById('uploadPlaceholder').classList.add('hidden'); document.getElementById('removeImageBtn').classList.remove('hidden'); document.getElementById('imageUploadLabel').classList.add('border-blue-500'); checkAnalyzeable(); document.getElementById('resultArea').classList.add('hidden'); }); event.target.value = '';
        }
        function removeImage(event) { event.preventDefault(); currentBase64 = null; document.getElementById('previewImage').src = ''; document.getElementById('previewImage').classList.add('hidden'); document.getElementById('uploadPlaceholder').classList.remove('hidden'); document.getElementById('removeImageBtn').classList.add('hidden'); document.getElementById('imageUploadLabel').classList.remove('border-blue-500'); checkAnalyzeable(); }
        function checkAnalyzeable() { const text = document.getElementById('textInput').value.trim(); document.getElementById('analyzeBtn').disabled = !(currentBase64 || text.length > 0); }
        function resizeImage(file, maxWidth = 800) { return new Promise((resolve) => { const img = new Image(); img.src = URL.createObjectURL(file); img.onload = () => { const canvas = document.createElement('canvas'); let w = img.width, h = img.height; if (w > maxWidth) { h = Math.round(h * (maxWidth / w)); w = maxWidth; } canvas.width = w; canvas.height = h; const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, w, h); resolve(canvas.toDataURL('image/jpeg', 0.7)); }; }); }
        async function analyze() {
            const apiKey = localStorage.getItem('gemini_api_key'); const model = localStorage.getItem('gemini_model') || 'gemini-2.5-flash'; const textMemo = document.getElementById('textInput').value.trim();
            if (!apiKey) { alert('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'); switchView('settings'); return; }
            document.getElementById('loadingArea').classList.remove('hidden'); document.getElementById('actionButtons').classList.add('hidden'); document.getElementById('resultArea').classList.add('hidden');
            const systemPrompt = `ã‚ãªãŸã¯æ¶ˆåŒ–å™¨å†…ç§‘ã®å°‚é–€çŸ¥è­˜ã‚’æŒã¤æ „é¤Šå£«ã§ã™ã€‚æä¾›ã•ã‚ŒãŸæ–™ç†ã®ç”»åƒã€ã¾ãŸã¯ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ï¼ˆã‚ã‚‹ã„ã¯ãã®ä¸¡æ–¹ï¼‰ã‚’è§£æã—ã€èƒƒè…¸ã«è² æ‹…ã‚’ã‹ã‘ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹æˆåˆ†ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ã€‚å¯¾è±¡ã¨ãªã‚‹æˆåˆ†ã®ä¾‹ï¼šè„‚è³ªã€ã‚«ãƒ—ã‚µã‚¤ã‚·ãƒ³ï¼ˆè¾›å‘³æˆåˆ†ï¼‰ã€ä¹³ç³–ã€ã‚°ãƒ«ãƒ†ãƒ³ã€ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã€é«˜FODMAPé£Ÿæã€å¼·ã„é…¸å‘³ã€æ¶ˆåŒ–ã®æ‚ªã„ç¹Šç¶­è³ªãªã©ã€‚å›ç­”ã¯å¿…ãšä»¥ä¸‹ã®JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®é…åˆ—ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚["æˆåˆ†A", "æˆåˆ†B", "æˆåˆ†C"] ã‚‚ã—ç‰¹ã«è©²å½“ã™ã‚‹æˆåˆ†ãŒãªã‘ã‚Œã°ç©ºã®é…åˆ— [] ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚`;
            let requestParts = [{ text: systemPrompt }]; if (textMemo) requestParts.push({ text: `ã€è£œè¶³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã€‘\n${textMemo}` }); if (currentBase64) requestParts.push({ inline_data: { mime_type: "image/jpeg", data: currentBase64.split(',')[1] } });
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
            try { const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: requestParts }] }) }); if (!response.ok) { if (response.status === 429) throw new Error('ãƒ¬ãƒ¼ãƒˆåˆ¶é™(ä½¿ã„ã™ã)ã§ã™ã€‚æ™‚é–“ã‚’ãŠã„ã¦ãã ã•ã„ã€‚'); if (response.status === 503) throw new Error('ã‚µãƒ¼ãƒãƒ¼æ··é›‘ä¸­ã€‚'); const errData = await response.json(); throw new Error(errData.error?.message || `API Error: ${response.status}`); } const data = await response.json(); const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text; if (!rawText) throw new Error('Geminiã‹ã‚‰ã®å¿œç­”ãŒç©ºã§ã—ãŸã€‚'); const jsonStr = rawText.replace(/```json|```/g, '').trim(); try { currentIngredients = JSON.parse(jsonStr); } catch (e) { currentIngredients = []; alert("è§£æçµæœã®å½¢å¼ãŒä¸æ­£ã§ã—ãŸã€‚"); } displayResults(currentIngredients); } catch (error) { console.error(error); alert(`è§£æã‚¨ãƒ©ãƒ¼:\n${error.message}`); document.getElementById('actionButtons').classList.remove('hidden'); } finally { document.getElementById('loadingArea').classList.add('hidden'); }
        }
        function displayResults(ingredients) { const container = document.getElementById('tagsContainer'); container.innerHTML = ''; if (!ingredients || ingredients.length === 0) { container.innerHTML = '<span class="text-gray-500 text-sm flex items-center"><i class="fa-regular fa-face-smile mr-1"></i>ç‰¹ã«ãªã— (èƒƒè…¸ã«å„ªã—ã„å¯èƒ½æ€§ãŒé«˜ã„ã§ã™)</span>'; } else { ingredients.forEach(tag => { const span = document.createElement('span'); span.className = 'bg-red-100 text-red-700 text-sm font-semibold px-3 py-1 rounded-full border border-red-200'; span.textContent = tag.length > 15 ? tag.substring(0,15) + '...' : tag; container.appendChild(span); }); } document.getElementById('resultArea').classList.remove('hidden'); }
        function saveLog(isAnalyzed) {
            if (!isAnalyzed) currentIngredients = [];
            const sleepTime = document.getElementById('sleepTime').value; const sleepQuality = document.getElementById('sleepQuality').value; const medication = document.getElementById('medicationInput').value.trim(); const exercise = document.getElementById('exerciseInput').value.trim(); const steps = document.getElementById('stepsInput').value; const textMemo = document.getElementById('textInput').value.trim();
            if (!currentBase64 && !textMemo && !sleepTime && !medication && !exercise && !steps) { alert('è¨˜éŒ²ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“'); return; }
            if (medication) { addToMedicationHistory(medication); }
            const newLog = { id: Date.now(), date: new Date().toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute:'2-digit' }), image: currentBase64, memo: textMemo, ingredients: currentIngredients, life: { sleepTime, sleepQuality, medication, exercise, steps } };
            let history = JSON.parse(localStorage.getItem('food_history') || '[]'); history.unshift(newLog); history = history.slice(0, 50);
            try { localStorage.setItem('food_history', JSON.stringify(history)); alert('è¨˜éŒ²ã—ã¾ã—ãŸ'); resetAnalyzeView(); switchView('history'); } catch (e) { alert('ä¿å­˜å®¹é‡ã®ä¸Šé™ã§ã™ã€‚å¤ã„å±¥æ­´ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚'); }
        }
        function resetAnalyzeView() {
            currentBase64 = null; currentIngredients = []; document.getElementById('textInput').value = ''; document.getElementById('sleepTime').value = ''; document.getElementById('sleepQuality').value = ''; document.getElementById('medicationInput').value = ''; document.getElementById('exerciseInput').value = ''; document.getElementById('stepsInput').value = '';
            removeImage(new Event('click')); document.getElementById('actionButtons').classList.remove('hidden'); document.getElementById('analyzeBtn').disabled = true; document.getElementById('resultArea').classList.add('hidden'); document.getElementById('autoFillMessage').classList.add('hidden');
        }
        function deleteLog(id) { if(!confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return; let history = JSON.parse(localStorage.getItem('food_history') || '[]'); history = history.filter(item => item.id !== id); localStorage.setItem('food_history', JSON.stringify(history)); renderHistory(selectedDate); updateStats(); renderCalendar(); }
        function clearAllData() { if(!confirm('ã™ã¹ã¦ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return; localStorage.removeItem('food_history'); renderHistory(); updateStats(); renderCalendar(); }
        function updateStats() {
            const history = JSON.parse(localStorage.getItem('food_history') || '[]'); const statsContainer = document.getElementById('statsContainer'); statsContainer.innerHTML = '';
            if (history.length === 0) { statsContainer.innerHTML = '<p class="text-sm text-gray-400 text-center py-4">ãƒ‡ãƒ¼ã‚¿ãŒé›†ã¾ã‚‹ã¨ã“ã“ã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>'; return; }
            const counts = {}; let totalDetected = 0; history.forEach(item => { if(item.ingredients) { item.ingredients.forEach(ing => { counts[ing] = (counts[ing] || 0) + 1; totalDetected++; }); } });
            if(totalDetected === 0) { statsContainer.innerHTML = '<p class="text-sm text-gray-400 text-center py-4">ã¾ã æ³¨æ„æˆåˆ†ã¯æ¤œå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“</p>'; return; }
            const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]).slice(0, 5); const maxCount = sorted[0][1]; const colors = ['bg-red-500', 'bg-orange-500', 'bg-amber-500', 'bg-yellow-500', 'bg-lime-500'];
            sorted.forEach(([name, count], index) => { const percentage = (count / maxCount) * 100; const barColor = colors[index % colors.length]; const html = `<div class="flex items-center justify-between text-sm mb-2"><span class="w-32 truncate font-bold text-gray-700" title="${name}">${name}</span><div class="flex-1 h-2.5 bg-gray-100 rounded-full overflow-hidden mx-3 relative"><div class="h-full ${barColor} rounded-full relative" style="width: ${percentage}%"></div></div><span class="text-gray-500 font-mono text-xs">${count}å›</span></div>`; statsContainer.insertAdjacentHTML('beforeend', html); });
        }
    </script>
</body>
</html>